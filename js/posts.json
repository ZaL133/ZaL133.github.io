[
  {
    "Key": "2016-02-05-Redirect",
    "PostDate": "2016-02-05T00:00:00",
    "PostTitle": "Redirect",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <title>More dependable than (my) memory</title>\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        <!-- Latest compiled and minified CSS -->\r\n        <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        <!-- Latest compiled and minified JavaScript -->\r\n        <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js\" integrity=\"sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS\" crossorigin=\"anonymous\"></script>        \r\n    </head>\r\n    <body>\r\n        <header class=\"navbar navbar-static-top bs-docs-nav\">\r\n            <nav class=\"navbar navbar-fixed-top\">\r\n                <div id='banner' class=\"container\">\r\n                    <ul class=\"nav navbar-nav\">\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                    </ul>\r\n                </div>\r\n            </nav>\r\n        </header>\r\n        <div id=\"body\" class=\"container\">\r\n            <p><!DOCTYPE html>\n<html>\n        <h1>Redirect</h1>\n        <p class=\"description\">\n            I can never remember which method to return for an MVC redirect.\n            <ul>\n                <li><a href=\"#redirect\">Redirect</a></li>\n                <li><a href=\"#redirectPerm\">RedirectPermanent</a></li>\n                <li><a href=\"#redirectAction\">RedirectToAction, RedirectToActionPermanent</a></li>\n                <li><a href=\"#redirectRoute\">RedirectToRoute, RedirectToRoutePermanent</a></li>\n                <li><a href=\"#transfer\">Transfer, TransferRequest</a></li>\n            </ul>\n        </p>\n        <div>\n            The main differences between the base and the *Permantent are the <code>Redirect</code> will return a <a href=\"https://en.wikipedia.org/wiki/HTTP_302\">302 (found)</a>, while the <code>RedirectPermanent</code> will return a <a href=\"https://en.wikipedia.org/wiki/HTTP_301\">301 (Moved Permantently) </a>\n        </div></p>\n\n<pre><code>    &lt;div id=\"redirect\" class=\"section\"&gt;\n        &lt;h2&gt;Redirect&lt;/h2&gt;\n        Returns a 302 (Found) to the given url\n        &lt;div&gt;\n            &lt;img src=\"RedirMethod.png\" alt=\"Redirect Method\" /&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;img src=\"RedirHeaders.png\" alt=\"Redirect Headers\" /&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div id=\"redirectPerm\" class=\"section\"&gt;\n        &lt;h2&gt;Redirect Permanent&lt;/h2&gt;\n        Returns a 301 (Moved Permanently) to the given url\n        &lt;div&gt;\n            &lt;img src=\"RedirPermMethod.png\" alt=\"Redirect Permanent Method\" /&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;img src=\"RedirPermHeaders.png\" alt=\"Redirect Permanent Headers\" /&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div id=\"redirectAction\"&gt;\n        &lt;h2&gt;RedirectToAction, RedirectToActionPermanent&lt;/h2&gt;\n        &lt;p&gt;These work the same as the Redirect(Permanent) methods, but are formed MVC-ish in that you specify the action, controller, and model as you would using the &lt;code&gt;@Url.Action&lt;/code&gt; helper method or &lt;code&gt;@Html.ActionLink&lt;/code&gt;\n        &lt;div&gt;\n            &lt;img src=\"RedirActionMethod.png\" alt=\"Redirect Permanent Method\" /&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;img src=\"RedirActionHeaders.png\" alt=\"Redirect Permanent Headers\" /&gt;\n        &lt;/div&gt;            \n    &lt;/div&gt;\n\n    &lt;div id=\"redirectRoute\"&gt;\n        &lt;h2&gt;RedirectToRoute, RedirectToRoutePermanent&lt;/h2&gt;\n        &lt;p&gt;These methods allow you to specify the route name (as specified in your RouteConfig.cs and stored in your &lt;a href=\"https://msdn.microsoft.com/en-us/library/system.web.routing.routetable.routes.aspx\"&gt;RouteTable&lt;/a&gt; ) &amp; values rather than the Action/Controller values.  &lt;/p&gt;\n        &lt;div&gt;\n            &lt;img src=\"RedirRouteMethod.png\" alt=\"Redirect Permanent Method\" /&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;img src=\"RedirRouteHeaders.png\" alt=\"Redirect Permanent Headers\" /&gt;\n        &lt;/div&gt;            \n    &lt;/div&gt;\n\n    &lt;div id=\"transfer\" class=\"section\"&gt;\n        &lt;h2&gt;Transfer, TransferRequest&lt;/h2&gt;\n        &lt;p&gt;These can be used to execute a different url and return the results&lt;br&gt;\n        &lt;code&gt;Transfer&lt;/code&gt; is used in &lt; IIS7&lt;br&gt;\n        &lt;code&gt;TransferRequest&lt;/code&gt; is used in &lt;a href=\"http://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/how-to-take-advantage-of-the-iis-integrated-pipeline\"&gt;Integrated Pipeline Mode&lt;/a&gt;\n        &lt;/p&gt;\n        &lt;div&gt;\n            &lt;img src=\"TransferRequestMethod.png\" alt=\"Transfer Request Method\" /&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;img src=\"TransferRequestHeaders.png\" alt=\"Transfer Request Headers\" /&gt;\n        &lt;/div&gt;                \n    &lt;/div&gt;\n</code></pre>\n\n<p></html></p>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Asp.net",
      "MVC"
    ]
  },
  {
    "Key": "2016-02-15-NuGet",
    "PostDate": "2016-02-15T00:00:00",
    "PostTitle": "NuGet",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <title>More dependable than (my) memory</title>\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        <!-- Latest compiled and minified CSS -->\r\n        <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        <!-- Latest compiled and minified JavaScript -->\r\n        <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js\" integrity=\"sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS\" crossorigin=\"anonymous\"></script>        \r\n    </head>\r\n    <body>\r\n        <header class=\"navbar navbar-static-top bs-docs-nav\">\r\n            <nav class=\"navbar navbar-fixed-top\">\r\n                <div id='banner' class=\"container\">\r\n                    <ul class=\"nav navbar-nav\">\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                    </ul>\r\n                </div>\r\n            </nav>\r\n        </header>\r\n        <div id=\"body\" class=\"container\">\r\n            <h1>Nuget</h1>\n\n<p><strong>Problem</strong>: One of the things I work on is Microsoft Dynamics CRM (Customer Relationship Management). This is a web based crm tool made by.... Microsoft. One of the great things about Dynamics CRM is that it provides data access via a very nice sdk. We've got about a dozen different tools &amp; utilities which talk to the CRM database via the SDK. </p>\n\n<pre><code>Recently we began the process of upgrading to Dynamics 2016. This invoved a new SDK as well as upgrading our code to use the new early-bound classes. \n\nThis requires going into each project, removing references to the old sdk, adding references to the new sdk as well as any related framework dependencies. Kind of a pain. \n</code></pre>\n\n<p>There is a good bit of ceremony required to get a simple app up and running though. You need to </p>\n\n<ol>\n<li>Add references to the SDK libraries.</li>\n<li>Add references to the related dependencies.</li>\n<li>Add an App.config file with the connection string</li>\n<li>Write the boilerplate context initiation </li>\n</ol>\n\n<p><strong>Solution</strong>: This seems like a good use for NuGet. </p>\n\n<p>The big plusses are that NuGet can help automate these repetitive tasks, as well as keep track of them! Additionaly it will make upgrades easer (and we are currently going through one). We also periodically make changes to the CRM system which alter the early-bound classes. Putting this stuff in a NuGet package source can help with updating when changes are made. </p>\n\n<p>The first step was to download the (NuGet Package Explorer)[https://npe.codeplex.com/]. This will make learning easier - I tried swinging at this from the command line but I'm impatient. </p>\n\n<p>Create a new package and fill out all the boring meta-data which is basically the exact same info you see when browsing the package manager. </p>\n\n<p><img src=\"Metadata.png\" alt=\"Meta-data\" /> </p>\n\n<p>Next is to add references to the sdk libraries. Because the sdk requires .net 452, they need to be added into the lib\\net452\\ folder. NuGet package explorer makes this easy with context aware menu's. </p>\n\n<ul>\n<li>Choose Content > Add > Lib folder</li>\n<li>Right click on the lib folder and choose add .Net folder > v4.5.2 (if you don't see this, you can choose 4.5.1 and rename the folder)</li>\n<li>Right click on net452 and choose Add Existing File</li>\n</ul>\n\n<p>easy peasy. If you package this up now, it will copy in the proper asemblies. </p>\n\n<p>Next add the references to the Framework assemblies. This can be done via the drop-down, nothing to add here. </p>\n\n<p>Next I want to add a class which handles some repetitive tasks like setting up a context for querying the databse. Since we're no longer dealing with references, we can forget about the <code>lib</code> folder and create a <code>content</code> folder. I'm going to go ahead and add a new cs file to the root of the <code>content</code> folder. Right click and add a file called Connection.cs. </p>\n\n<pre>\nusing System;\nusing System.Configuration;\nusing GNYHA.CRM.Dynamics;\nusing Microsoft.Xrm.Sdk;\nusing Microsoft.Xrm.Tooling.Connector;\n\nnamespace ????\n{\n    public static class Connection \n    {\n        private static CrmServiceClient ServiceClient\n        {\n            get \n            {\n                return new CrmServiceClient(ConfigurationManager.AppSettings[\"CrmConnectionString\"]);\n            }\n        }\n\n        public static IOrganizationService Service\n        {\n            get \n            {\n                return ServiceClient.OrganizationWebProxyClient ?? (IOrganizationService)ServiceClient.OrganizationServiceProxy;\n            }\n        }\n    }\n}\n</pre>\n\n<p>The problem is what to use for the namespace. I could leave this un-namespaced but that doesn't seem right. Reading the (documentation)[https://docs.nuget.org/create/configuration-file-and-source-code-transformations] this is a VERY common issue and you can use source code transformations to handle. Just </p>\n\n<ol>\n<li>Rename the file and add .pp to the end</li>\n<li>Use $rootnamespace$. You can actually use any (Project property)[https://msdn.microsoft.com/en-us/library/vslangproj.projectproperties_properties(VS.80).aspx]. </li>\n</ol>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "NuGet"
    ]
  },
  {
    "Key": "2016-02-17-Dynamics-CRM-Find-event-handlers-for-form",
    "PostDate": "2016-02-17T00:00:00",
    "PostTitle": "Dynamics-CRM-Find-event-handlers-for-form",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <title>More dependable than (my) memory</title>\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        <!-- Latest compiled and minified CSS -->\r\n        <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        <!-- Latest compiled and minified JavaScript -->\r\n        <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js\" integrity=\"sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS\" crossorigin=\"anonymous\"></script>        \r\n    </head>\r\n    <body>\r\n        <header class=\"navbar navbar-static-top bs-docs-nav\">\r\n            <nav class=\"navbar navbar-fixed-top\">\r\n                <div id='banner' class=\"container\">\r\n                    <ul class=\"nav navbar-nav\">\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                    </ul>\r\n                </div>\r\n            </nav>\r\n        </header>\r\n        <div id=\"body\" class=\"container\">\r\n            <h1>Find which event handlers are bound on a form.</h1>\n\n<p>Dynamics CRM gives you the ability through the front-end to bind event handlers to a set of ui events.  </p>\n\n<p><img src='handler-list.png' alt='Event Handler List' /></p>\n\n<p>This is one of the most likely areas to break during an upgrade, so I wanted to get a list of <strong>all</strong> event handlers in the system so we had an idea of what needed to be tested. Unfortunately after quite a bit of poking around, it became clear that this info isn't <em>super</em> easy to pull out of the SQL database. The problem is that this info is stored in the FormXml field of the SystemForm table. </p>\n\n<p><img src='handler-xml.png' alt='Event Handler Xml' /></p>\n\n<p>Without being super familiar with querying against XML data in MSSQL, this took quite a bit of research. Posting the result </p>\n\n<pre><code class=\"sql\">\nWITH x AS \n(\n       SELECT FormId, e.Name, CAST(FormXml AS Xml) FormXml \n       FROM SystemForm sf\n       JOIN Entity e ON sf.ObjectTypeCode = e.ObjectTypeCode AND e.OverwriteTime = '1900-01-01 00:00:00.000'\n       WHERE e.Name = 'Account'\n)\n, y AS \n(\n       SELECT \n              x.FormId,\n              x.Name Entity, \n              x.FormXml, -- Uncomment to see the full form xml\n              t.c.value('@name', 'varchar(max)') HandlerName,\n              t.c.value('@attribute', 'varchar(max)') AttributeName,\n              a.b.value('@libraryName', 'varchar(max)') Library,\n              a.b.value('@functionName', 'varchar(max)') FunctionName,\n              a.b.value('@enabled', 'varchar(16)') [Enabled],\n              t.c.query('.') [t.c.query], \n              a.b.query('.') [a.b.query]\n       FROM  x\n       CROSS APPLY x.FormXml.nodes('/form/events/event') T(c)\n       OUTER APPLY t.c.nodes('Handlers/Handler') a(b)\n       WHERE t.c.value('count(Handlers/Handler)', 'int') > 0\n)\n\nSELECT \n       *\nFROM y \n-- WHERE Enabled = 'true' -- This will exclude non-attribute related rows\nORDER BY y.Entity, y.HandlerName, y.Library, y.FunctionName\n</code>\n</pre>  \r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Dynamics CRM"
    ]
  },
  {
    "Key": "2016-02-19-Cant-connect-to-xrmtoolbox",
    "PostDate": "2016-02-19T00:00:00",
    "PostTitle": "Cant-connect-to-xrmtoolbox",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <title>More dependable than (my) memory</title>\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        <!-- Latest compiled and minified CSS -->\r\n        <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        <!-- Latest compiled and minified JavaScript -->\r\n        <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js\" integrity=\"sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS\" crossorigin=\"anonymous\"></script>        \r\n    </head>\r\n    <body>\r\n        <header class=\"navbar navbar-static-top bs-docs-nav\">\r\n            <nav class=\"navbar navbar-fixed-top\">\r\n                <div id='banner' class=\"container\">\r\n                    <ul class=\"nav navbar-nav\">\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                    </ul>\r\n                </div>\r\n            </nav>\r\n        </header>\r\n        <div id=\"body\" class=\"container\">\r\n            <p><strong>I can't seem to get XrmToolbox to connect to Dynamics 2016 which is configured for claims based authentication.</strong> </p>\n\n<h2>Research</h2>\n\n<p>XrmToolbox uses the MscrmTools.Xrm.Connection </p>\n\n<p>MscrmTools.Xrm.Connection uses CrmServiceClient\n    https://github.com/MscrmTools/MscrmTools.Xrm.Connection/blob/master/McTools.Xrm.Connection/ConnectionDetail.cs</p>\n\n<p>I can't get a simple app using CrmServiceClient to log in to Crm 2016 IFD</p>\n\n<pre><code>    class Program\n    {\n        private static readonly CrmServiceClient _crmClient = new Microsoft.Xrm.Tooling.Connector.CrmServiceClient(ConfigurationManager.AppSettings[\"CrmConnectionString\"]);\n        private static readonly IOrganizationService _service = _crmClient.OrganizationWebProxyClient ?? (IOrganizationService)_crmClient.OrganizationServiceProxy;\n\n        static void Main(string[] args)\n        {\n            using (var ctx = new gnyhacontext(_service))\n            {\n                foreach (var account in ctx.AccountSet.Where(x => x.Name.StartsWith(\"Al\")))\n                {\n                    Console.WriteLine(\"Name: {0}\", account.Name);\n                }\n            }\n\n            Console.WriteLine(\"Done!\\nPress any key to continue...\");\n            Console.ReadKey();\n        }\n    }</code></pre>\n\n<p>Looking through the crm sdk sample code, I put together a simple connection using their methods. This DOES work </p>\n\n<pre><code>        static void Main(string[] args)\n        {\n            var organizatonUri = new Uri(\"https://crmdev.gnyha.org/Dynamics/XRMServices/2011/Organization.svc\");\n            AuthenticationCredentials credentials = new AuthenticationCredentials();\n            credentials.ClientCredentials.UserName.UserName = \"username\";\n            credentials.ClientCredentials.UserName.Password = \"password\";\n\n            var serviceManagement = ServiceConfigurationFactory.CreateManagement<IOrganizationService>(organizatonUri);\n            AuthenticationCredentials token = serviceManagement.Authenticate(credentials);\n\n            var organizationServiceProxy = new OrganizationServiceProxy(serviceManagement, token.SecurityTokenResponse);\n            organizationServiceProxy.EnableProxyTypes();\n\n            using (var ctx = new gnyhacontext(organizationServiceProxy))\n            {\n                foreach (var account in ctx.AccountSet.Where(x => x.Name.StartsWith(\"Al\")))\n                {\n                    Console.WriteLine(\"Name: {0}\", account.Name);\n                }\n            }\n\n            Console.WriteLine(\"Done!\\nPress any key to continue...\");\n            Console.ReadKey();\n        }</code></pre>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Dynamics CRM",
      "XrmToolbox"
    ]
  },
  {
    "Key": "2016-04-26-Dynamics-CRM-IFD-Without-Login-Internally",
    "PostDate": "2016-04-26T00:00:00",
    "PostTitle": "Dynamics-CRM-IFD-Without-Login-Internally",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <title>More dependable than (my) memory</title>\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        <!-- Latest compiled and minified CSS -->\r\n        <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        <!-- Latest compiled and minified JavaScript -->\r\n        <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js\" integrity=\"sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS\" crossorigin=\"anonymous\"></script>        \r\n    </head>\r\n    <body>\r\n        <header class=\"navbar navbar-static-top bs-docs-nav\">\r\n            <nav class=\"navbar navbar-fixed-top\">\r\n                <div id='banner' class=\"container\">\r\n                    <ul class=\"nav navbar-nav\">\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                    </ul>\r\n                </div>\r\n            </nav>\r\n        </header>\r\n        <div id=\"body\" class=\"container\">\r\n            <h1>Using URL Rewrite to fix IFD access</h1>\n\n<h2>Summary</h2>\n\n<p>I want to use the IFD url for crm everywhere, but I don't want internal users to hit a login page</p>\n\n<h2>Details</h2>\n\n<p>Microsoft Dynamics has a number of different authentication scenario's for an On-Premise installation. If you want to publish your CRM instance externally, you need to configure your system as an IFD (Internet Facing Deployment). </p>\n\n<p>The way that it works is that well documented on the microsoft site. The problem that we have is that we are split 80/20 internal vs external crm access. So we really want to optimize the experience for the internal users, but we still want to provide external access. By simply having external access, you have to configure your system as an IFD. </p>\n\n<p>CRM separates internal vs external traffic based on the url. All IFD access is done via the url https://<em>organization</em>.<strong>domain.com</strong>. All interal access is done via the url https://<strong>internalname</strong>/<em>organization</em>. </p>\n\n<p>This presents a problem. We want a single url that we can distribute. This is good both for communication - we can always tell everyone the same thing and it's easier to remember; and practically - if an internal rep sends a link to an external rep - it just works, if you bookmark the site when you're internal, it will still work when you bring your laptop home. </p>\n\n<p>I think the cleanest url is the IFD. We <em>could</em> distribute the external url to everyone, but the issue is that when you hit the external url, even from inside the network, you are greeted by a login page. </p>\n\n<p><img src='adfs-login-page.png' alt='ADFS Login Page' /></p>\n\n<p>This ain't going to cut it. Some people are in/out of crm all day. </p>\n\n<h2>Solution - Use Url Rewrite!!</h2>\n\n<p>Using Fiddler, I can see that the first response when I access the external url is a 302 with a Location of our adfs server. </p>\n\n<p><img src='first-response-302.png' alt='First hit 302' /></p>\n\n<p>The location looks encoded, so I use Fiddler's text wizard to decode the output. (It is actually double encoded, so you need to URLDecode, then \"Send output to input\" and URLDecode again). </p>\n\n<p><img src='location-decoded.png' alt='Location Decoded' /></p>\n\n<p>The thing to notice here is the <a href=\"https://msdn.microsoft.com/en-us/library/ee895365.aspx#sectionSection2\">authentication method is Password</a>. This is the user name and password screen. <a href=\"https://msdn.microsoft.com/en-us/library/system.identitymodel.tokens.samlauthenticationstatement.authenticationmethod(v=vs.110).aspx\">A list of authentication methods can be found on msdn</a>. </p>\n\n<p>It looks like the default is Unspecified and when I try simply removing the wauth parameter, I am logged in - yay! So all we need to do is pull that parameter off of the 302 for internal users. </p>\n\n<h3><a href=\"http://www.iis.net/downloads/microsoft/url-rewrite\">In comes the IIS Url Rewrite module</a></h3>\n\n<p>The URL Rewrite module is installed by default with Dynamics CRM. It allows you to do powerful transformations on inbound and outbound messages. We can use the URL Rewrite module to a) Detect when a request is on the internal network, and b) rewrite the 302 request to remove the username and password parameter on the adfs redirect. </p>\n\n<p>To do this, create a new Outbound rule. </p>\n\n<p>I used a pre-condition so that we are only applying this transformation on local traffic. Our company uses the 10.* network for internal</p>\n\n<p><img src=\"pre-condition.png\" alt=\"Pre-Condition\" /></p>\n\n<p>Then we need to set up the Match. Since we're manipulating one of the headers (Location), switch the matching scope to Server Variable, and set the Variable name to RESPONSE_Location. </p>\n\n<p>For the matching pattern, i use <code>(https.<em>)(/</em>&amp;wauth=urn%3aoasis%3anames%3atc%3aSAML%3a1.0%3aam%3apassword)</code>. This will nicely partition the <code>wauth</code> parameter from the rest of the url. You can see in the screenshot that this gets captured into group {R:1}.</p>\n\n<p><img src=\"test-pattern.png\" alt=\"Test Pattern\" /></p>\n\n<p>Knowing which capture group, you can just plug that into the Action tab using the <code>Rewrite</code> Action type: </p>\n\n<p><img src=\"action.png\" alt=\"Action\" /></p>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Dynamics CRM",
      "Authentication",
      "IFD",
      "ADFS"
    ]
  },
  {
    "Key": "2016-04-27-Start-IIS-Express-from-the-command-line",
    "PostDate": "2016-04-27T00:00:00",
    "PostTitle": "Start-IIS-Express-from-the-command-line",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <title>More dependable than (my) memory</title>\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        <!-- Latest compiled and minified CSS -->\r\n        <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        <!-- Latest compiled and minified JavaScript -->\r\n        <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js\" integrity=\"sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS\" crossorigin=\"anonymous\"></script>        \r\n    </head>\r\n    <body>\r\n        <header class=\"navbar navbar-static-top bs-docs-nav\">\r\n            <nav class=\"navbar navbar-fixed-top\">\r\n                <div id='banner' class=\"container\">\r\n                    <ul class=\"nav navbar-nav\">\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                    </ul>\r\n                </div>\r\n            </nav>\r\n        </header>\r\n        <div id=\"body\" class=\"container\">\r\n            <h1>How to start IIS Express from the command line</h1>\n\n<p>This is something that comes up a lot which I can never seem to remember. I don't want to configure a new website every time I want to treat a directory like a site.</p>\n\n<pre>\n    <code>\n        C:>cd \"C:\\Program Files (x86)\\IIS Express\"\n        C:\\Program Files (x86)\\IIS Express>iisexpress.exe /path:{path_to_directory} /port:{portnumber}\n        C:\\Program Files (x86)\\IIS Express>iexplore \"http://localhost:{portnumber}\"\n    </code>\n</pre>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "IIS Express"
    ]
  }
]