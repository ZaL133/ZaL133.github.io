[
  {
    "Key": "2016-02-05-Redirect",
    "PostDate": "2016-02-05T00:00:00",
    "PostTitle": "Redirect",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <title>More dependable than (my) memory</title>\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        <!-- Latest compiled and minified CSS -->\r\n        <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        <!-- Latest compiled and minified JavaScript -->\r\n        <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js\" integrity=\"sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS\" crossorigin=\"anonymous\"></script>        \r\n    </head>\r\n    <body>\r\n        <header class=\"navbar navbar-static-top bs-docs-nav\">\r\n            <nav class=\"navbar navbar-fixed-top\">\r\n                <div id='banner' class=\"container\">\r\n                    <ul class=\"nav navbar-nav\">\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                    </ul>\r\n                </div>\r\n            </nav>\r\n        </header>\r\n        <div id=\"body\" class=\"container\">\r\n            <p><!DOCTYPE html>\n<html>\n        <h1>Redirect</h1>\n        <p class=\"description\">\n            I can never remember which method to return for an MVC redirect.\n            <ul>\n                <li><a href=\"#redirect\">Redirect</a></li>\n                <li><a href=\"#redirectPerm\">RedirectPermanent</a></li>\n                <li><a href=\"#redirectAction\">RedirectToAction, RedirectToActionPermanent</a></li>\n                <li><a href=\"#redirectRoute\">RedirectToRoute, RedirectToRoutePermanent</a></li>\n                <li><a href=\"#transfer\">Transfer, TransferRequest</a></li>\n            </ul>\n        </p>\n        <div>\n            The main differences between the base and the *Permantent are the <code>Redirect</code> will return a <a href=\"https://en.wikipedia.org/wiki/HTTP_302\">302 (found)</a>, while the <code>RedirectPermanent</code> will return a <a href=\"https://en.wikipedia.org/wiki/HTTP_301\">301 (Moved Permantently) </a>\n        </div></p>\n\n<pre><code>    &lt;div id=\"redirect\" class=\"section\"&gt;\n        &lt;h2&gt;Redirect&lt;/h2&gt;\n        Returns a 302 (Found) to the given url\n        &lt;div&gt;\n            &lt;img src=\"RedirMethod.png\" alt=\"Redirect Method\" /&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;img src=\"RedirHeaders.png\" alt=\"Redirect Headers\" /&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div id=\"redirectPerm\" class=\"section\"&gt;\n        &lt;h2&gt;Redirect Permanent&lt;/h2&gt;\n        Returns a 301 (Moved Permanently) to the given url\n        &lt;div&gt;\n            &lt;img src=\"RedirPermMethod.png\" alt=\"Redirect Permanent Method\" /&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;img src=\"RedirPermHeaders.png\" alt=\"Redirect Permanent Headers\" /&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n\n    &lt;div id=\"redirectAction\"&gt;\n        &lt;h2&gt;RedirectToAction, RedirectToActionPermanent&lt;/h2&gt;\n        &lt;p&gt;These work the same as the Redirect(Permanent) methods, but are formed MVC-ish in that you specify the action, controller, and model as you would using the &lt;code&gt;@Url.Action&lt;/code&gt; helper method or &lt;code&gt;@Html.ActionLink&lt;/code&gt;\n        &lt;div&gt;\n            &lt;img src=\"RedirActionMethod.png\" alt=\"Redirect Permanent Method\" /&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;img src=\"RedirActionHeaders.png\" alt=\"Redirect Permanent Headers\" /&gt;\n        &lt;/div&gt;            \n    &lt;/div&gt;\n\n    &lt;div id=\"redirectRoute\"&gt;\n        &lt;h2&gt;RedirectToRoute, RedirectToRoutePermanent&lt;/h2&gt;\n        &lt;p&gt;These methods allow you to specify the route name (as specified in your RouteConfig.cs and stored in your &lt;a href=\"https://msdn.microsoft.com/en-us/library/system.web.routing.routetable.routes.aspx\"&gt;RouteTable&lt;/a&gt; ) &amp; values rather than the Action/Controller values.  &lt;/p&gt;\n        &lt;div&gt;\n            &lt;img src=\"RedirRouteMethod.png\" alt=\"Redirect Permanent Method\" /&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;img src=\"RedirRouteHeaders.png\" alt=\"Redirect Permanent Headers\" /&gt;\n        &lt;/div&gt;            \n    &lt;/div&gt;\n\n    &lt;div id=\"transfer\" class=\"section\"&gt;\n        &lt;h2&gt;Transfer, TransferRequest&lt;/h2&gt;\n        &lt;p&gt;These can be used to execute a different url and return the results&lt;br&gt;\n        &lt;code&gt;Transfer&lt;/code&gt; is used in &lt; IIS7&lt;br&gt;\n        &lt;code&gt;TransferRequest&lt;/code&gt; is used in &lt;a href=\"http://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/how-to-take-advantage-of-the-iis-integrated-pipeline\"&gt;Integrated Pipeline Mode&lt;/a&gt;\n        &lt;/p&gt;\n        &lt;div&gt;\n            &lt;img src=\"TransferRequestMethod.png\" alt=\"Transfer Request Method\" /&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;img src=\"TransferRequestHeaders.png\" alt=\"Transfer Request Headers\" /&gt;\n        &lt;/div&gt;                \n    &lt;/div&gt;\n</code></pre>\n\n<p></html></p>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Asp.net",
      "MVC"
    ]
  },
  {
    "Key": "2016-02-15-NuGet",
    "PostDate": "2016-02-15T00:00:00",
    "PostTitle": "NuGet",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <title>More dependable than (my) memory</title>\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        <!-- Latest compiled and minified CSS -->\r\n        <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        <!-- Latest compiled and minified JavaScript -->\r\n        <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js\" integrity=\"sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS\" crossorigin=\"anonymous\"></script>        \r\n    </head>\r\n    <body>\r\n        <header class=\"navbar navbar-static-top bs-docs-nav\">\r\n            <nav class=\"navbar navbar-fixed-top\">\r\n                <div id='banner' class=\"container\">\r\n                    <ul class=\"nav navbar-nav\">\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                    </ul>\r\n                </div>\r\n            </nav>\r\n        </header>\r\n        <div id=\"body\" class=\"container\">\r\n            <h1>Nuget</h1>\n\n<p><strong>Problem</strong>: One of the things I work on is Microsoft Dynamics CRM (Customer Relationship Management). This is a web based crm tool made by.... Microsoft. One of the great things about Dynamics CRM is that it provides data access via a very nice sdk. We've got about a dozen different tools &amp; utilities which talk to the CRM database via the SDK. </p>\n\n<pre><code>Recently we began the process of upgrading to Dynamics 2016. This invoved a new SDK as well as upgrading our code to use the new early-bound classes. \n\nThis requires going into each project, removing references to the old sdk, adding references to the new sdk as well as any related framework dependencies. Kind of a pain. \n</code></pre>\n\n<p>There is a good bit of ceremony required to get a simple app up and running though. You need to </p>\n\n<ol>\n<li>Add references to the SDK libraries.</li>\n<li>Add references to the related dependencies.</li>\n<li>Add an App.config file with the connection string</li>\n<li>Write the boilerplate context initiation </li>\n</ol>\n\n<p><strong>Solution</strong>: This seems like a good use for NuGet. </p>\n\n<p>The big plusses are that NuGet can help automate these repetitive tasks, as well as keep track of them! Additionaly it will make upgrades easer (and we are currently going through one). We also periodically make changes to the CRM system which alter the early-bound classes. Putting this stuff in a NuGet package source can help with updating when changes are made. </p>\n\n<p>The first step was to download the (NuGet Package Explorer)[https://npe.codeplex.com/]. This will make learning easier - I tried swinging at this from the command line but I'm impatient. </p>\n\n<p>Create a new package and fill out all the boring meta-data which is basically the exact same info you see when browsing the package manager. </p>\n\n<p><img src=\"Metadata.png\" alt=\"Meta-data\" /> </p>\n\n<p>Next is to add references to the sdk libraries. Because the sdk requires .net 452, they need to be added into the lib\\net452\\ folder. NuGet package explorer makes this easy with context aware menu's. </p>\n\n<ul>\n<li>Choose Content > Add > Lib folder</li>\n<li>Right click on the lib folder and choose add .Net folder > v4.5.2 (if you don't see this, you can choose 4.5.1 and rename the folder)</li>\n<li>Right click on net452 and choose Add Existing File</li>\n</ul>\n\n<p>easy peasy. If you package this up now, it will copy in the proper asemblies. </p>\n\n<p>Next add the references to the Framework assemblies. This can be done via the drop-down, nothing to add here. </p>\n\n<p>Next I want to add a class which handles some repetitive tasks like setting up a context for querying the databse. Since we're no longer dealing with references, we can forget about the <code>lib</code> folder and create a <code>content</code> folder. I'm going to go ahead and add a new cs file to the root of the <code>content</code> folder. Right click and add a file called Connection.cs. </p>\n\n<pre>\nusing System;\nusing System.Configuration;\nusing GNYHA.CRM.Dynamics;\nusing Microsoft.Xrm.Sdk;\nusing Microsoft.Xrm.Tooling.Connector;\n\nnamespace ????\n{\n    public static class Connection \n    {\n        private static CrmServiceClient ServiceClient\n        {\n            get \n            {\n                return new CrmServiceClient(ConfigurationManager.AppSettings[\"CrmConnectionString\"]);\n            }\n        }\n\n        public static IOrganizationService Service\n        {\n            get \n            {\n                return ServiceClient.OrganizationWebProxyClient ?? (IOrganizationService)ServiceClient.OrganizationServiceProxy;\n            }\n        }\n    }\n}\n</pre>\n\n<p>The problem is what to use for the namespace. I could leave this un-namespaced but that doesn't seem right. Reading the (documentation)[https://docs.nuget.org/create/configuration-file-and-source-code-transformations] this is a VERY common issue and you can use source code transformations to handle. Just </p>\n\n<ol>\n<li>Rename the file and add .pp to the end</li>\n<li>Use $rootnamespace$. You can actually use any (Project property)[https://msdn.microsoft.com/en-us/library/vslangproj.projectproperties_properties(VS.80).aspx]. </li>\n</ol>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "NuGet"
    ]
  },
  {
    "Key": "2016-02-17-Dynamics-CRM-Find-event-handlers-for-form",
    "PostDate": "2016-02-17T00:00:00",
    "PostTitle": "Dynamics-CRM-Find-event-handlers-for-form",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <title>More dependable than (my) memory</title>\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        <!-- Latest compiled and minified CSS -->\r\n        <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        <!-- Latest compiled and minified JavaScript -->\r\n        <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js\" integrity=\"sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS\" crossorigin=\"anonymous\"></script>        \r\n    </head>\r\n    <body>\r\n        <header class=\"navbar navbar-static-top bs-docs-nav\">\r\n            <nav class=\"navbar navbar-fixed-top\">\r\n                <div id='banner' class=\"container\">\r\n                    <ul class=\"nav navbar-nav\">\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                    </ul>\r\n                </div>\r\n            </nav>\r\n        </header>\r\n        <div id=\"body\" class=\"container\">\r\n            <h1>Find which event handlers are bound on a form.</h1>\n\n<p>Dynamics CRM gives you the ability through the front-end to bind event handlers to a set of ui events.  </p>\n\n<p><img src='handler-list.png' alt='Event Handler List' /></p>\n\n<p>This is one of the most likely areas to break during an upgrade, so I wanted to get a list of <strong>all</strong> event handlers in the system so we had an idea of what needed to be tested. Unfortunately after quite a bit of poking around, it became clear that this info isn't <em>super</em> easy to pull out of the SQL database. The problem is that this info is stored in the FormXml field of the SystemForm table. </p>\n\n<p><img src='handler-xml.png' alt='Event Handler Xml' /></p>\n\n<p>Without being super familiar with querying against XML data in MSSQL, this took quite a bit of research. Posting the result </p>\n\n<pre><code class=\"sql\">\nWITH x AS \n(\n       SELECT FormId, e.Name, CAST(FormXml AS Xml) FormXml \n       FROM SystemForm sf\n       JOIN Entity e ON sf.ObjectTypeCode = e.ObjectTypeCode AND e.OverwriteTime = '1900-01-01 00:00:00.000'\n       WHERE e.Name = 'Account'\n)\n, y AS \n(\n       SELECT \n              x.FormId,\n              x.Name Entity, \n              x.FormXml, -- Uncomment to see the full form xml\n              t.c.value('@name', 'varchar(max)') HandlerName,\n              t.c.value('@attribute', 'varchar(max)') AttributeName,\n              a.b.value('@libraryName', 'varchar(max)') Library,\n              a.b.value('@functionName', 'varchar(max)') FunctionName,\n              a.b.value('@enabled', 'varchar(16)') [Enabled],\n              t.c.query('.') [t.c.query], \n              a.b.query('.') [a.b.query]\n       FROM  x\n       CROSS APPLY x.FormXml.nodes('/form/events/event') T(c)\n       OUTER APPLY t.c.nodes('Handlers/Handler') a(b)\n       WHERE t.c.value('count(Handlers/Handler)', 'int') > 0\n)\n\nSELECT \n       *\nFROM y \n-- WHERE Enabled = 'true' -- This will exclude non-attribute related rows\nORDER BY y.Entity, y.HandlerName, y.Library, y.FunctionName\n</code>\n</pre>  \r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Dynamics CRM"
    ]
  },
  {
    "Key": "2016-02-19-Cant-connect-to-xrmtoolbox",
    "PostDate": "2016-02-19T00:00:00",
    "PostTitle": "Cant-connect-to-xrmtoolbox",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <title>More dependable than (my) memory</title>\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        <!-- Latest compiled and minified CSS -->\r\n        <link rel=\"stylesheet\" href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        <!-- Latest compiled and minified JavaScript -->\r\n        <script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js\" integrity=\"sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS\" crossorigin=\"anonymous\"></script>        \r\n    </head>\r\n    <body>\r\n        <header class=\"navbar navbar-static-top bs-docs-nav\">\r\n            <nav class=\"navbar navbar-fixed-top\">\r\n                <div id='banner' class=\"container\">\r\n                    <ul class=\"nav navbar-nav\">\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                    </ul>\r\n                </div>\r\n            </nav>\r\n        </header>\r\n        <div id=\"body\" class=\"container\">\r\n            <p><strong>I can't seem to get XrmToolbox to connect to Dynamics 2016 which is configured for claims based authentication.</strong> </p>\n\n<h2>Research</h2>\n\n<p>XrmToolbox uses the MscrmTools.Xrm.Connection </p>\n\n<p>MscrmTools.Xrm.Connection uses CrmServiceClient\n    https://github.com/MscrmTools/MscrmTools.Xrm.Connection/blob/master/McTools.Xrm.Connection/ConnectionDetail.cs</p>\n\n<p>I can't get a simple app using CrmServiceClient to log in to Crm 2016 IFD</p>\n\n<pre><code>    class Program\n    {\n        private static readonly CrmServiceClient _crmClient = new Microsoft.Xrm.Tooling.Connector.CrmServiceClient(ConfigurationManager.AppSettings[\"CrmConnectionString\"]);\n        private static readonly IOrganizationService _service = _crmClient.OrganizationWebProxyClient ?? (IOrganizationService)_crmClient.OrganizationServiceProxy;\n\n        static void Main(string[] args)\n        {\n            using (var ctx = new gnyhacontext(_service))\n            {\n                foreach (var account in ctx.AccountSet.Where(x => x.Name.StartsWith(\"Al\")))\n                {\n                    Console.WriteLine(\"Name: {0}\", account.Name);\n                }\n            }\n\n            Console.WriteLine(\"Done!\\nPress any key to continue...\");\n            Console.ReadKey();\n        }\n    }</code></pre>\n\n<p>Looking through the crm sdk sample code, I put together a simple connection using their methods. This DOES work </p>\n\n<pre><code>        static void Main(string[] args)\n        {\n            var organizatonUri = new Uri(\"https://crmdev.gnyha.org/Dynamics/XRMServices/2011/Organization.svc\");\n            AuthenticationCredentials credentials = new AuthenticationCredentials();\n            credentials.ClientCredentials.UserName.UserName = \"username\";\n            credentials.ClientCredentials.UserName.Password = \"password\";\n\n            var serviceManagement = ServiceConfigurationFactory.CreateManagement<IOrganizationService>(organizatonUri);\n            AuthenticationCredentials token = serviceManagement.Authenticate(credentials);\n\n            var organizationServiceProxy = new OrganizationServiceProxy(serviceManagement, token.SecurityTokenResponse);\n            organizationServiceProxy.EnableProxyTypes();\n\n            using (var ctx = new gnyhacontext(organizationServiceProxy))\n            {\n                foreach (var account in ctx.AccountSet.Where(x => x.Name.StartsWith(\"Al\")))\n                {\n                    Console.WriteLine(\"Name: {0}\", account.Name);\n                }\n            }\n\n            Console.WriteLine(\"Done!\\nPress any key to continue...\");\n            Console.ReadKey();\n        }</code></pre>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Dynamics CRM",
      "XrmToolbox"
    ]
  }
]