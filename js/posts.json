[
  {
    "Key": "2016-02-05-Redirect",
    "PostDate": "2016-02-05T00:00:00",
    "PostTitle": "Redirect",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n        <meta name=\"author\" value=\"Zeph Levin\">\r\n\r\n        <title>(un)specified behaviour</title>\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        \r\n        <!-- Site Style -->\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />        \r\n    </head>\r\n    <body>\r\n        <header>\r\n            <div class='wrapper'>\r\n                <nav>\r\n                    <ul>\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                        <li><a href=\"/about-me.html\">About Me</a></li>\r\n                    </ul>\r\n                </nav>\r\n            </div>\r\n        </header>\r\n        <div class='accent'></div>\r\n        <div class='wrapper'>\r\n            <div id=\"body\" class=\"container\">\r\n                <h1>Redirect</h1>\n\n<p>I can never remember which method to return for an MVC redirect.</p>\n\n<ul>\n<li><a href=\"#redirect\">Redirect</a></li>\n<li><a href=\"#redirectPerm\">RedirectPermanent</a></li>\n<li><a href=\"#redirectAction\">RedirectToAction, RedirectToActionPermanent</a></li>\n<li><a href=\"#redirectRoute\">RedirectToRoute, RedirectToRoutePermanent</a></li>\n<li><a href=\"#transfer\">Transfer, TransferRequest</a>&lt;</li>\n</ul>\n\n<p>The main differences between the base and the *Permantent are the <code>Redirect</code> will return a <a href=\"https://en.wikipedia.org/wiki/HTTP_302\">302 (found)</a>, while the <code>RedirectPermanent</code> will return a <a href=\"https://en.wikipedia.org/wiki/HTTP_301\">301 (Moved Permantently) </a></p>\n\n<h2>Redirect <a name=\"redirect\"></a></h2>\n\n<p>Returns a 302 (Found) to the given url</p>\n\n<p><img src=\"RedirMethod.png\" alt=\"Redirect Method\" /></p>\n\n<p><img src=\"RedirHeaders.png\" alt=\"Redirect Headers\" /></p>\n\n<h2>Redirect Permanent <a name=\"redirectPerm\"></a></h2>\n\n<p>Returns a 301 (Moved Permanently) to the given url</p>\n\n<p><img src=\"RedirPermMethod.png\" alt=\"Redirect Permanent Method\" /></p>\n\n<p><img src=\"RedirPermHeaders.png\" alt=\"Redirect Permanent Headers\" /></p>\n\n<h2>RedirectToAction, RedirectToActionPermanent <a name=\"redirectAction\"></a></h2>\n\n<p>These work the same as the Redirect(Permanent) methods, but are formed MVC-ish in that you specify the action, controller, and model as you would using the <code>@Url.Action</code> helper method or <code>@Html.ActionLink</code></p>\n\n<p><img src=\"RedirActionMethod.png\" alt=\"Redirect Permanent Method\" /></p>\n\n<p><img src=\"RedirActionHeaders.png\" alt=\"Redirect Permanent Headers\" /></p>\n\n<h2>RedirectToRoute, RedirectToRoutePermanent <a name=\"redirectRoute\"></a></h2>\n\n<p>These methods allow you to specify the route name (as specified in your RouteConfig.cs and stored in your <a href=\"https://msdn.microsoft.com/en-us/library/system.web.routing.routetable.routes.aspx\">RouteTable</a> ) &amp; values rather than the Action/Controller values.</p>\n\n<p><img src=\"RedirRouteMethod.png\" alt=\"Redirect Permanent Method\" /></p>\n\n<p><img src=\"RedirRouteHeaders.png\" alt=\"Redirect Permanent Headers\" /></p>\n\n<h2>Transfer, TransferRequest <a name=\"transfer\"></a></h2>\n\n<p>These can be used to execute a different url and return the results</p>\n\n<p><code>Transfer</code> is used in &lt; IIS7<br>\n<code>TransferRequest</code> is used in <a href=\"http://www.iis.net/learn/application-frameworks/building-and-running-aspnet-applications/how-to-take-advantage-of-the-iis-integrated-pipeline\">Integrated Pipeline Mode</a></p>\n\n<p><img src=\"TransferRequestMethod.png\" alt=\"Transfer Request Method\" /></p>\n\n<p><img src=\"TransferRequestHeaders.png\" alt=\"Transfer Request Headers\" /></p>\r\n            </div>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n            $(function() {\r\n\r\n                // If you click on an image open it in a new window\r\n                $(\"img\").click(function() {\r\n                    var url = $(this).attr(\"src\");\r\n                    window.open(url, \"_blank\");\r\n                });\r\n            });\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Asp.net",
      "MVC"
    ]
  },
  {
    "Key": "2016-02-15-NuGet",
    "PostDate": "2016-02-15T00:00:00",
    "PostTitle": "NuGet",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n        <meta name=\"author\" value=\"Zeph Levin\">\r\n\r\n        <title>(un)specified behaviour</title>\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        \r\n        <!-- Site Style -->\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />        \r\n    </head>\r\n    <body>\r\n        <header>\r\n            <div class='wrapper'>\r\n                <nav>\r\n                    <ul>\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                        <li><a href=\"/about-me.html\">About Me</a></li>\r\n                    </ul>\r\n                </nav>\r\n            </div>\r\n        </header>\r\n        <div class='accent'></div>\r\n        <div class='wrapper'>\r\n            <div id=\"body\" class=\"container\">\r\n                <h1>Nuget</h1>\n\n<p><strong>Problem</strong>: One of the things I work on is Microsoft Dynamics CRM (Customer Relationship Management). This is a web based crm tool made by.... Microsoft. One of the great things about Dynamics CRM is that it provides data access via a very nice sdk. We've got about a dozen different tools &amp; utilities which talk to the CRM database via the SDK. </p>\n\n<pre><code>Recently we began the process of upgrading to Dynamics 2016. This invoved a new SDK as well as upgrading our code to use the new early-bound classes. \n\nThis requires going into each project, removing references to the old sdk, adding references to the new sdk as well as any related framework dependencies. Kind of a pain. \n</code></pre>\n\n<p>There is a good bit of ceremony required to get a simple app up and running though. You need to </p>\n\n<ol>\n<li>Add references to the SDK libraries.</li>\n<li>Add references to the related dependencies.</li>\n<li>Add an App.config file with the connection string</li>\n<li>Write the boilerplate context initiation </li>\n</ol>\n\n<p><strong>Solution</strong>: This seems like a good use for NuGet. </p>\n\n<p>The big plusses are that NuGet can help automate these repetitive tasks, as well as keep track of them! Additionaly it will make upgrades easer (and we are currently going through one). We also periodically make changes to the CRM system which alter the early-bound classes. Putting this stuff in a NuGet package source can help with updating when changes are made. </p>\n\n<p>The first step was to download the (NuGet Package Explorer)[https://npe.codeplex.com/]. This will make learning easier - I tried swinging at this from the command line but I'm impatient. </p>\n\n<p>Create a new package and fill out all the boring meta-data which is basically the exact same info you see when browsing the package manager. </p>\n\n<p><img src=\"Metadata.png\" alt=\"Meta-data\" /> </p>\n\n<p>Next is to add references to the sdk libraries. Because the sdk requires .net 452, they need to be added into the lib\\net452\\ folder. NuGet package explorer makes this easy with context aware menu's. </p>\n\n<ul>\n<li>Choose Content > Add > Lib folder</li>\n<li>Right click on the lib folder and choose add .Net folder > v4.5.2 (if you don't see this, you can choose 4.5.1 and rename the folder)</li>\n<li>Right click on net452 and choose Add Existing File</li>\n</ul>\n\n<p>easy peasy. If you package this up now, it will copy in the proper asemblies. </p>\n\n<p>Next add the references to the Framework assemblies. This can be done via the drop-down, nothing to add here. </p>\n\n<p>Next I want to add a class which handles some repetitive tasks like setting up a context for querying the databse. Since we're no longer dealing with references, we can forget about the <code>lib</code> folder and create a <code>content</code> folder. I'm going to go ahead and add a new cs file to the root of the <code>content</code> folder. Right click and add a file called Connection.cs. </p>\n\n<pre>\nusing System;\nusing System.Configuration;\nusing Microsoft.Xrm.Sdk;\nusing Microsoft.Xrm.Tooling.Connector;\n\nnamespace ????\n{\n    public static class Connection \n    {\n        private static CrmServiceClient ServiceClient\n        {\n            get \n            {\n                return new CrmServiceClient(ConfigurationManager.AppSettings[\"CrmConnectionString\"]);\n            }\n        }\n\n        public static IOrganizationService Service\n        {\n            get \n            {\n                return ServiceClient.OrganizationWebProxyClient ?? (IOrganizationService)ServiceClient.OrganizationServiceProxy;\n            }\n        }\n    }\n}\n</pre>\n\n<p>The problem is what to use for the namespace. I could leave this un-namespaced but that doesn't seem right. Reading the (documentation)[https://docs.nuget.org/create/configuration-file-and-source-code-transformations] this is a VERY common issue and you can use source code transformations to handle. Just </p>\n\n<ol>\n<li>Rename the file and add .pp to the end</li>\n<li>Use $rootnamespace$. You can actually use any (Project property)[https://msdn.microsoft.com/en-us/library/vslangproj.projectproperties_properties(VS.80).aspx]. </li>\n</ol>\r\n            </div>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n            $(function() {\r\n\r\n                // If you click on an image open it in a new window\r\n                $(\"img\").click(function() {\r\n                    var url = $(this).attr(\"src\");\r\n                    window.open(url, \"_blank\");\r\n                });\r\n            });\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "NuGet"
    ]
  },
  {
    "Key": "2016-02-17-Dynamics-CRM-Find-event-handlers-for-form",
    "PostDate": "2016-02-17T00:00:00",
    "PostTitle": "Dynamics-CRM-Find-event-handlers-for-form",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n        <meta name=\"author\" value=\"Zeph Levin\">\r\n\r\n        <title>(un)specified behaviour</title>\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        \r\n        <!-- Site Style -->\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />        \r\n    </head>\r\n    <body>\r\n        <header>\r\n            <div class='wrapper'>\r\n                <nav>\r\n                    <ul>\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                        <li><a href=\"/about-me.html\">About Me</a></li>\r\n                    </ul>\r\n                </nav>\r\n            </div>\r\n        </header>\r\n        <div class='accent'></div>\r\n        <div class='wrapper'>\r\n            <div id=\"body\" class=\"container\">\r\n                <h1>Find which event handlers are bound on a form.</h1>\n\n<p>Dynamics CRM gives you the ability through the front-end to bind event handlers to a set of ui events.  </p>\n\n<p><img src='handler-list.png' alt='Event Handler List' /></p>\n\n<p>This is one of the most likely areas to break during an upgrade, so I wanted to get a list of <strong>all</strong> event handlers in the system so we had an idea of what needed to be tested. Unfortunately after quite a bit of poking around, it became clear that this info isn't <em>super</em> easy to pull out of the SQL database. The problem is that this info is stored in the FormXml field of the SystemForm table. </p>\n\n<p><img src='handler-xml.png' alt='Event Handler Xml' /></p>\n\n<p>Without being super familiar with querying against XML data in MSSQL, this took quite a bit of research. Posting the result </p>\n\n<pre><code class=\"sql\">\nWITH x AS \n(\n       SELECT FormId, e.Name, CAST(FormXml AS Xml) FormXml \n       FROM SystemForm sf\n       JOIN Entity e ON sf.ObjectTypeCode = e.ObjectTypeCode AND e.OverwriteTime = '1900-01-01 00:00:00.000'\n       WHERE e.Name = 'Account'\n)\n, y AS \n(\n       SELECT \n              x.FormId,\n              x.Name Entity, \n              x.FormXml, -- Uncomment to see the full form xml\n              t.c.value('@name', 'varchar(max)') HandlerName,\n              t.c.value('@attribute', 'varchar(max)') AttributeName,\n              a.b.value('@libraryName', 'varchar(max)') Library,\n              a.b.value('@functionName', 'varchar(max)') FunctionName,\n              a.b.value('@enabled', 'varchar(16)') [Enabled],\n              t.c.query('.') [t.c.query], \n              a.b.query('.') [a.b.query]\n       FROM  x\n       CROSS APPLY x.FormXml.nodes('/form/events/event') T(c)\n       OUTER APPLY t.c.nodes('Handlers/Handler') a(b)\n       WHERE t.c.value('count(Handlers/Handler)', 'int') > 0\n)\n\nSELECT \n       *\nFROM y \n-- WHERE Enabled = 'true' -- This will exclude non-attribute related rows\nORDER BY y.Entity, y.HandlerName, y.Library, y.FunctionName\n</code>\n</pre>  \r\n            </div>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n            $(function() {\r\n\r\n                // If you click on an image open it in a new window\r\n                $(\"img\").click(function() {\r\n                    var url = $(this).attr(\"src\");\r\n                    window.open(url, \"_blank\");\r\n                });\r\n            });\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Dynamics CRM"
    ]
  },
  {
    "Key": "2016-02-19-Cant-connect-to-xrmtoolbox",
    "PostDate": "2016-02-19T00:00:00",
    "PostTitle": "Cant-connect-to-xrmtoolbox",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n        <meta name=\"author\" value=\"Zeph Levin\">\r\n\r\n        <title>(un)specified behaviour</title>\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        \r\n        <!-- Site Style -->\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />        \r\n    </head>\r\n    <body>\r\n        <header>\r\n            <div class='wrapper'>\r\n                <nav>\r\n                    <ul>\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                        <li><a href=\"/about-me.html\">About Me</a></li>\r\n                    </ul>\r\n                </nav>\r\n            </div>\r\n        </header>\r\n        <div class='accent'></div>\r\n        <div class='wrapper'>\r\n            <div id=\"body\" class=\"container\">\r\n                <p><strong>I can't seem to get XrmToolbox to connect to Dynamics 2016 which is configured for claims based authentication.</strong> </p>\n\n<h2>Research</h2>\n\n<p>XrmToolbox uses the MscrmTools.Xrm.Connection </p>\n\n<p>MscrmTools.Xrm.Connection uses CrmServiceClient\n    https://github.com/MscrmTools/MscrmTools.Xrm.Connection/blob/master/McTools.Xrm.Connection/ConnectionDetail.cs</p>\n\n<p>I can't get a simple app using CrmServiceClient to log in to Crm 2016 IFD</p>\n\n<pre><code>    class Program\n    {\n        private static readonly CrmServiceClient _crmClient = new Microsoft.Xrm.Tooling.Connector.CrmServiceClient(ConfigurationManager.AppSettings[\"CrmConnectionString\"]);\n        private static readonly IOrganizationService _service = _crmClient.OrganizationWebProxyClient ?? (IOrganizationService)_crmClient.OrganizationServiceProxy;\n\n        static void Main(string[] args)\n        {\n            using (var ctx = new organizationcontext(_service))\n            {\n                foreach (var account in ctx.AccountSet.Where(x => x.Name.StartsWith(\"Al\")))\n                {\n                    Console.WriteLine(\"Name: {0}\", account.Name);\n                }\n            }\n\n            Console.WriteLine(\"Done!\\nPress any key to continue...\");\n            Console.ReadKey();\n        }\n    }</code></pre>\n\n<p>Looking through the crm sdk sample code, I put together a simple connection using their methods. This DOES work </p>\n\n<pre><code>        static void Main(string[] args)\n        {\n            var organizatonUri = new Uri(\"https://crmdev.organization.com/orgname/XRMServices/2011/Organization.svc\");\n            AuthenticationCredentials credentials = new AuthenticationCredentials();\n            credentials.ClientCredentials.UserName.UserName = \"username\";\n            credentials.ClientCredentials.UserName.Password = \"password\";\n\n            var serviceManagement = ServiceConfigurationFactory.CreateManagement<IOrganizationService>(organizatonUri);\n            AuthenticationCredentials token = serviceManagement.Authenticate(credentials);\n\n            var organizationServiceProxy = new OrganizationServiceProxy(serviceManagement, token.SecurityTokenResponse);\n            organizationServiceProxy.EnableProxyTypes();\n\n            using (var ctx = new organizationcontext(organizationServiceProxy))\n            {\n                foreach (var account in ctx.AccountSet.Where(x => x.Name.StartsWith(\"Al\")))\n                {\n                    Console.WriteLine(\"Name: {0}\", account.Name);\n                }\n            }\n\n            Console.WriteLine(\"Done!\\nPress any key to continue...\");\n            Console.ReadKey();\n        }</code></pre>\r\n            </div>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n            $(function() {\r\n\r\n                // If you click on an image open it in a new window\r\n                $(\"img\").click(function() {\r\n                    var url = $(this).attr(\"src\");\r\n                    window.open(url, \"_blank\");\r\n                });\r\n            });\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Dynamics CRM",
      "XrmToolbox"
    ]
  },
  {
    "Key": "2016-04-26-Dynamics-CRM-IFD-Without-Login-Internally",
    "PostDate": "2016-04-26T00:00:00",
    "PostTitle": "Dynamics-CRM-IFD-Without-Login-Internally",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n        <meta name=\"author\" value=\"Zeph Levin\">\r\n\r\n        <title>(un)specified behaviour</title>\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        \r\n        <!-- Site Style -->\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />        \r\n    </head>\r\n    <body>\r\n        <header>\r\n            <div class='wrapper'>\r\n                <nav>\r\n                    <ul>\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                        <li><a href=\"/about-me.html\">About Me</a></li>\r\n                    </ul>\r\n                </nav>\r\n            </div>\r\n        </header>\r\n        <div class='accent'></div>\r\n        <div class='wrapper'>\r\n            <div id=\"body\" class=\"container\">\r\n                <h1>Using URL Rewrite to fix IFD access</h1>\n\n<h2>Summary</h2>\n\n<p>I want to use the IFD url for crm everywhere, but I don't want internal users to hit a login page</p>\n\n<h2>Details</h2>\n\n<p>Microsoft Dynamics has a number of different authentication scenario's for an On-Premise installation. If you want to publish your CRM instance externally, you need to configure your system as an IFD (Internet Facing Deployment). </p>\n\n<p>The way that it works is that well documented on the microsoft site. The problem that we have is that we are split 80/20 internal vs external crm access. So we really want to optimize the experience for the internal users, but we still want to provide external access. By simply having external access, you have to configure your system as an IFD. </p>\n\n<p>CRM separates internal vs external traffic based on the url. All IFD access is done via the url https://<em>organization</em>.<strong>domain.com</strong>. All interal access is done via the url https://<strong>internalname</strong>/<em>organization</em>. </p>\n\n<p>This presents a problem. We want a single url that we can distribute. This is good both for communication - we can always tell everyone the same thing and it's easier to remember; and practically - if an internal rep sends a link to an external rep - it just works, if you bookmark the site when you're internal, it will still work when you bring your laptop home. </p>\n\n<p>I think the cleanest url is the IFD. We <em>could</em> distribute the external url to everyone, but the issue is that when you hit the external url, even from inside the network, you are greeted by a login page. </p>\n\n<p><img src='adfs-login-page.png' alt='ADFS Login Page' /></p>\n\n<p>This ain't going to cut it. Some people are in/out of crm all day. </p>\n\n<h2>Solution - Use Url Rewrite!!</h2>\n\n<p>Using Fiddler, I can see that the first response when I access the external url is a 302 with a Location of our adfs server. </p>\n\n<p><img src='first-response-302.png' alt='First hit 302' /></p>\n\n<p>The location looks encoded, so I use Fiddler's text wizard to decode the output. (It is actually double encoded, so you need to URLDecode, then \"Send output to input\" and URLDecode again). </p>\n\n<p><img src='location-decoded.png' alt='Location Decoded' /></p>\n\n<p>The thing to notice here is the <a href=\"https://msdn.microsoft.com/en-us/library/ee895365.aspx#sectionSection2\">authentication method is Password</a>. This is the user name and password screen. <a href=\"https://msdn.microsoft.com/en-us/library/system.identitymodel.tokens.samlauthenticationstatement.authenticationmethod(v=vs.110).aspx\">A list of authentication methods can be found on msdn</a>. </p>\n\n<p>It looks like the default is Unspecified and when I try simply removing the wauth parameter, I am logged in - yay! So all we need to do is pull that parameter off of the 302 for internal users. </p>\n\n<h3><a href=\"http://www.iis.net/downloads/microsoft/url-rewrite\">In comes the IIS Url Rewrite module</a></h3>\n\n<p>The URL Rewrite module is installed by default with Dynamics CRM. It allows you to do powerful transformations on inbound and outbound messages. We can use the URL Rewrite module to a) Detect when a request is on the internal network, and b) rewrite the 302 request to remove the username and password parameter on the adfs redirect. </p>\n\n<p>To do this, create a new Outbound rule. </p>\n\n<p>I used a pre-condition so that we are only applying this transformation on local traffic. Our company uses the 10.* network for internal</p>\n\n<p><img src=\"pre-condition.png\" alt=\"Pre-Condition\" /></p>\n\n<p>Then we need to set up the Match. Since we're manipulating one of the headers (Location), switch the matching scope to Server Variable, and set the Variable name to RESPONSE_Location. </p>\n\n<p>For the matching pattern, i use <code>(https.<em>)(/</em>&amp;wauth=urn%3aoasis%3anames%3atc%3aSAML%3a1.0%3aam%3apassword)</code>. This will nicely partition the <code>wauth</code> parameter from the rest of the url. You can see in the screenshot that this gets captured into group {R:1}.</p>\n\n<p><img src=\"test-pattern.png\" alt=\"Test Pattern\" /></p>\n\n<p>Knowing which capture group, you can just plug that into the Action tab using the <code>Rewrite</code> Action type: </p>\n\n<p><img src=\"action.png\" alt=\"Action\" /></p>\r\n            </div>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n            $(function() {\r\n\r\n                // If you click on an image open it in a new window\r\n                $(\"img\").click(function() {\r\n                    var url = $(this).attr(\"src\");\r\n                    window.open(url, \"_blank\");\r\n                });\r\n            });\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Dynamics CRM",
      "Authentication",
      "IFD",
      "ADFS",
      "Unsupported"
    ]
  },
  {
    "Key": "2016-04-27-Start-IIS-Express-from-the-command-line",
    "PostDate": "2016-04-27T00:00:00",
    "PostTitle": "Start-IIS-Express-from-the-command-line",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n        <meta name=\"author\" value=\"Zeph Levin\">\r\n\r\n        <title>(un)specified behaviour</title>\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        \r\n        <!-- Site Style -->\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />        \r\n    </head>\r\n    <body>\r\n        <header>\r\n            <div class='wrapper'>\r\n                <nav>\r\n                    <ul>\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                        <li><a href=\"/about-me.html\">About Me</a></li>\r\n                    </ul>\r\n                </nav>\r\n            </div>\r\n        </header>\r\n        <div class='accent'></div>\r\n        <div class='wrapper'>\r\n            <div id=\"body\" class=\"container\">\r\n                <h1>How to start IIS Express from the command line</h1>\n\n<p>This is something that comes up a lot which I can never seem to remember. I don't want to configure a new website every time I want to treat a directory like a site.</p>\n\n<pre>\n    <code>\n        C:>cd \"C:\\Program Files (x86)\\IIS Express\"\n        C:\\Program Files (x86)\\IIS Express>iisexpress.exe /path:{path_to_directory} /port:{portnumber}\n        C:\\Program Files (x86)\\IIS Express>iexplore \"http://localhost:{portnumber}\"\n    </code>\n</pre>\r\n            </div>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n            $(function() {\r\n\r\n                // If you click on an image open it in a new window\r\n                $(\"img\").click(function() {\r\n                    var url = $(this).attr(\"src\");\r\n                    window.open(url, \"_blank\");\r\n                });\r\n            });\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "IIS Express"
    ]
  },
  {
    "Key": "2016-11-30-CRM-2016-Document-list-doesnt-scroll-in-IE11",
    "PostDate": "2016-11-30T00:00:00",
    "PostTitle": "CRM-2016-Document-list-doesnt-scroll-in-IE11",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n        <meta name=\"author\" value=\"Zeph Levin\">\r\n\r\n        <title>(un)specified behaviour</title>\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        \r\n        <!-- Site Style -->\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />        \r\n    </head>\r\n    <body>\r\n        <header>\r\n            <div class='wrapper'>\r\n                <nav>\r\n                    <ul>\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                        <li><a href=\"/about-me.html\">About Me</a></li>\r\n                    </ul>\r\n                </nav>\r\n            </div>\r\n        </header>\r\n        <div class='accent'></div>\r\n        <div class='wrapper'>\r\n            <div id=\"body\" class=\"container\">\r\n                <h1>CRM 2016 - Document list doesn't scroll in IE11</h1>\n\n<p>After upgrading to dynamics 2016 and doing a little testing of the sharepoint integration, we noticed a strange bug with the crm list component. </p>\n\n<p>The crm list component is the skin installed on the sharepoint server which has the proper look and feel to be displayed in crm inside an iframe. The purpose is to allow you to use a full featured document management system without <em>feeling</em> like you left the crm system. </p>\n\n<p>The problem we were seeing is that if the number of documents exceeded the size of the available space, in IE11 the scroll bar  wasn't showing up, and so there really was no way to access the documents which are out of view, and there is no way to get to the paging buttons which are located on the bottom of this frame. </p>\n\n<p><img src='ie11-broken.png' alt='IE 11 Broken' style='width: 45%;' />\n<img src='chrome-ok.png' alt='Chrome Fixed' style='width: 45%;' /></p>\n\n<p>Oddly, this wasn't the case in crm 2011 - which we upgraded from, and isn't an issue with previous issues of internet explorer. It also works fine in chrome (we don't test Firefox). </p>\n\n<h3>time to fire up the dev tools</h3>\n\n<p>This was actually a pretty easy issue to spot. If you look at the HTML inspector, you can see that the document list is in a div with <code>height: 100%</code>, and that div is in a table cell with a fixed height. The height of this cell changes if you resize the window. </p>\n\n<p>In IE11 specifically though, if you check the properties of the table cell you can see that the fixed height isn't being respected by the browser. The table cell is actually expanding to the size of its inner content, and so when the div is sized to 100% there is no overflow and nothing to scroll. </p>\n\n<p><img src='not-good.png' alt='Not Good' /></p>\n\n<p>This particular quirk is noted <a href=\"http://stackoverflow.com/a/27384730\">on stackoverflow.com</a> which essentially states that setting a fixed height on an element with a display mode of table-cell is undefined behavior. Browsers are free to choose how to handle. </p>\n\n<p>So to fix this we just need to get some CSS on the page which sets the display mode of a table cell with a fixed height to inline-block. Tested this works in dev tools. Since this is in an iframe, the only place this can possible come from is the sharepoint server</p>\n\n<p>To fix - the crmlistcomponent sharepoint library needs to be patched. Luckily, this is for the most part just a packaged group of .net web components - .html, .js, .css, .net libraries etc. </p>\n\n<p>Login to the sharepoint server as an admin and go to Site Actions > Site Settings > Solution, then download the list component.</p>\n\n<p><img src='sharepoint-download.png' alt='Sharepoint Download' /> </p>\n\n<p>This downloads as a .wsp file but is actually a cab file - so rename the file to include the .cab extension</p>\n\n<p>Run the EXPAND cl-utility to unpack the cab file</p>\n\n<p><code><pre>C:\\dev\\Temp>mkdir crmlistcomponent.wsp</p>\n\n<p>C:\\dev\\Temp>expand crmlistcomponent.wsp.cab crmlistcomponent.wsp -F:*</pre></code></p>\n\n<p>Locate the <code>Layouts\\crmgrid.css</code> file and add a rule at the very bottom which sets the display mode to inline-block. The below uses an attribute selector to apply only to table cell elements which contain a style tag with a fixed height;</p>\n\n<p><code><pre>#crmGrid td[style*=\"height\"] {\n    display: inline-block;\n}</pre></code></p>\n\n<p>Re-pack the .cab file using the cli tool MAKECAB. I ended up using <a href=\"http://stackoverflow.com/a/24668955/972250\">this powershell snippet</a> to handle the options of packing a whole directory for me. </p>\n\n<p>Rename the file to remove the .cab extension. (That should leave you with a file called crmlistcomponent.wsp). </p>\n\n<p>Replace your existing sharepoint crm list component. (Deactivate / upload / activate)</p>\n\n<p>Test!</p>\r\n            </div>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n            $(function() {\r\n\r\n                // If you click on an image open it in a new window\r\n                $(\"img\").click(function() {\r\n                    var url = $(this).attr(\"src\");\r\n                    window.open(url, \"_blank\");\r\n                });\r\n            });\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Dynamics CRM",
      "Sharepoint",
      "Unsupported"
    ]
  },
  {
    "Key": "2016-12-03-Crm-2016-8.1.0.359-object-expected",
    "PostDate": "2016-12-03T00:00:00",
    "PostTitle": "Crm-2016-8.1.0.359-object-expected",
    "PostBody": "<html>\r\n    <head>\r\n        <meta charset=\"utf-8\" />\r\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\r\n        <meta name=\"author\" value=\"Zeph Levin\">\r\n\r\n        <title>(un)specified behaviour</title>\r\n        <link rel=\"stylesheet\" href=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/styles/default.min.css\">\r\n        \r\n        <!-- Scripts --> \r\n        <script src=\"//code.jquery.com/jquery-2.2.0.min.js\"></script>        \r\n        <script src=\"//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.1.0/highlight.min.js\"></script>\r\n        \r\n        <!-- Site Style -->\r\n        <link type=\"text/css\" rel=\"stylesheet\" href=\"/css/site.css\" />        \r\n    </head>\r\n    <body>\r\n        <header>\r\n            <div class='wrapper'>\r\n                <nav>\r\n                    <ul>\r\n                        <li><a href=\"/\">Home</a></li>\r\n                        <li><a href=\"/search.html\">Search</a></li>\r\n                        <li><a href=\"/tags.html\">Tags</a></li>\r\n                        <li><a href=\"/about-me.html\">About Me</a></li>\r\n                    </ul>\r\n                </nav>\r\n            </div>\r\n        </header>\r\n        <div class='accent'></div>\r\n        <div class='wrapper'>\r\n            <div id=\"body\" class=\"container\">\r\n                <h1>Crm 2016 8.1.0.359 - object expected</h1>\n\n<p>About a month before upgrading our system from Dynamics CRM 2011 to 2016, we were troubleshooting performance and specifically form load times. Nothing seemed to work and we had created an ootb organization with no customizations, so most of this time was spent trying to tweak IIS setting. Nothing seemed to get the <a href=\"https://en.wikipedia.org/wiki/Time_To_First_Byte\">TTFB</a> time below about .3 seconds which actually feels pretty slow and with 200+ resources on a page, adds up. We had done all our upgrade testing and prep in the rtm version and saw that there was a service pack available. </p>\n\n<p>After installing this service page - things are MUCH better - the screen transitions are much much snappier and the TTFB is down to about .056 seconds. </p>\n\n<p>We ran some quick tests to check for regressions and were on our way. </p>\n\n<p>About a week after launch we start getting complaints about these annoying Microsoft errors popping up sporadically. </p>\n\n<p><img src='crm-has-encountered-an-error.png' alt='Micrsoft Dynamics CRM has encountered an error' /></p>\n\n<p>These happen in crm when there is an unhandled JavaScript exception. Since we do a fair bit of js customization in our org, these errors are critical to letting the user know that something has gone wrong. (I think there should be an option to send these exceptions to ME INSTEAD OF MICROSOFT, but I digress).</p>\n\n<p>So we find out some repro information from a user and are able to replicate the error - which only happens in internet explorer (naturally). It happens most often when leaving the contact form either by saving or closing. Crm of course catches these errors and them and waits to show them to a user until the least relevant time possible. Below is the exception you get by clicking \"see what this error report contains\"</p>\n\n<pre><code>&lt;CrmScriptErrorReport&gt;\n  &lt;ReportVersion&gt;1.0&lt;/ReportVersion&gt;\n  &lt;ScriptErrorDetails&gt;\n   &lt;Message&gt;Object expected&lt;/Message&gt;\n   &lt;Line&gt;15499&lt;/Line&gt;\n   &lt;URL&gt;&lt;/URL&gt;\n   &lt;PageURL&gt;/form/page.aspx?lcid=1033&amp;themeId=351f664e-a6d1-4733-1cf7-b3235fca2d91&amp;tstamp=11053490&amp;updateTimeStamp=636135147600972731&amp;userts=131237789654599814&amp;ver=-580792269#etc=1&amp;extraqs=%3f_CreateFromId%3d%257bE5321C35-CB2F-4EBB-A4CC-77FAA0C43389%257d%26_CreateFromType%3d4300%26_gridType%3d1%26etc%3d1%26id%3d%257b5DC1AD2E-4F4B-460D-A748-958043CD4CB2%257d%26rskey%3d%257b00000000-0000-0000-00AA-000010001200%257d&amp;pagemode=iframe&amp;pagetype=entityrecord&amp;rskey=%7b00000000-0000-0000-00AA-000010001200%7d&amp;counter=1479332942490&lt;/PageURL&gt;\n   &lt;Function&gt;anonymousr:Objectexpected&lt;/Function&gt;\n   &lt;FunctionRaw&gt;TypeError: Object expected&lt;/FunctionRaw&gt;\n   &lt;CallStack&gt;\n    &lt;Function&gt;anonymousr:Objectexpected&lt;/Function&gt;\n   &lt;/CallStack&gt;\n  &lt;/ScriptErrorDetails&gt;\n  &lt;ClientInformation&gt;\n   &lt;BrowserUserAgent&gt;Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET4.0C; .NET4.0E; rv:11.0) like Gecko&lt;/BrowserUserAgent&gt;\n   &lt;BrowserLanguage&gt;en-US&lt;/BrowserLanguage&gt;\n   &lt;SystemLanguage&gt;en-US&lt;/SystemLanguage&gt;\n   &lt;UserLanguage&gt;en-US&lt;/UserLanguage&gt;\n   &lt;ScreenResolution&gt;1920x1080&lt;/ScreenResolution&gt;\n   &lt;ClientName&gt;Web&lt;/ClientName&gt;\n   &lt;ClienState&gt;Online&lt;/ClienState&gt;\n   &lt;ClientTime&gt;2016-11-16T16:49:03&lt;/ClientTime&gt;\n  &lt;/ClientInformation&gt;\n  &lt;ServerInformation&gt;\n    &lt;OrgLanguage&gt;1033&lt;/OrgLanguage&gt;\n    &lt;OrgCulture&gt;1033&lt;/OrgCulture&gt;\n    &lt;UserLanguage&gt;1033&lt;/UserLanguage&gt;\n    &lt;UserCulture&gt;1033&lt;/UserCulture&gt;\n    &lt;OrgID&gt;{0ED23A84-6DC6-E311-99A3-9C8E99160E80}&lt;/OrgID&gt;\n    &lt;UserID&gt;{BFF92392-470C-46C9-A71B-83988DEEB489}&lt;/UserID&gt;\n    &lt;CRMVersion&gt;8.1.0.359&lt;/CRMVersion&gt;\n  &lt;/ServerInformation&gt;\n&lt;/CrmScriptErrorReport&gt;\n</code></pre>\n\n<p>So that's not very helpful. The message is super generic (object expected) and the call stack doesn't look very helpful either. Enough to google though.</p>\n\n<p>[posts referencing this error]</p>\n\n<p>Great. So this is a big introduced in the newest version, and it happens on any form which includes a web page - web resource. There is no fix for it. The only work-arounds are </p>\n\n<p>A) remove the we resource from the form. Um, not a good solution. (My foot hurts when I walk. So don't walk - all better right?). Besides, for the most part these web resources aren't ours, but added by a third party managed solution. So we'd have to remove these solution and that's not an option</p>\n\n<p>B) update our users preferences to either <em>always</em> or <em>never</em> send these errors to msft. The effect of this is users no longer get notified of errors, the system just eats them up. Are you kidding me? What if we're using js to validate a field and the validation fails? We'd have to rewrite <em>all</em> our js code to catch everything and have our own mechanism for alerting. That's a lot of work and not really reasonable. </p>\n\n<p>C) wait for a fix. This is a good option, it's a pretty ugly bug. Must be high priority. Oh wait there's very little info online about the road map, and I happen to have opened a big report about another issue with msft, so I took the opportunity to ask the crm tech about next service pack and he said they haven't seen anything yet and so it would probably be 1st quarter 2017 some time. We can't very well leave people getting error messages all over the place for months.</p>\n\n<p>D) revert to legacy form rendering. This does fix the issue, but in testing - breaks something which is actually critical to us and is not an option ( involves field validation and the save and close button ). </p>\n\n<p>E) try to fix this ourselves. This is a dumb error message. It happens when loading a web resource which seems to load fine anyway. It seems to be caused by the new form rendering engine which [quote from msft about new form ending optimization ]. </p>\n\n<p>Ok so let's dig in. I fire up ie dev tools, and change the debugger to pause at any exception, so I can see at what point the error is thrown. </p>\n\n<p>[pic of ie debugger]</p>\n\n<p>It happens before the form is loaded, and the code appears to be trying to get a reference to the web resource key. </p>\n\n<p>[Pic of code at exception]</p>\n\n<p>If you drill into the code here you'll see it's trying to find the field by enumerating all the fields on the form, then checking each one for a matching key. Since the form isn't loaded, the controls are all blank and don't have a key. Hence <code>object expected</code>. Fine - nothing we can do make these controls load earlier, that's waaaay outside the scope of what I'm willing to do.</p>\n\n<p>But this is a stupid error message which doesn't have any noticeable impact anyway. So maybe we can find a good place to catch this error ourselves, and we can handle the exception - that's perfect. </p>\n\n<p>Look up the call stack and you can see it's being called by </p>\n\n<p>[pic 1 - whatever]</p>\n\n<p>Side note: wait a second is this horribly inefficient code to boot?</p>\n\n<p>There's a great place, this routing is just doing [summarize what it's doing]. </p>\n\n<p>Ok though so there the code fix to make, but which JavaScript file is this coming from?</p>\n\n<p>\\javascript.aspx</p>\n\n<p>Lovely. Well I'm not going to be thwarted that easily - I log in to the crm server, open the directory for the crm web application, change my search options to look through the file contents and then search for the function name. </p>\n\n<p>[result] </p>\n\n<p>Success!!  Open this up, and though it's compressed (whitespace removed), it's not minified (turned your beautiful code into a heaping pile of letter crap to save space). </p>\n\n<p>A quick code patch later, reset IIS, and there you go. No more errors (except when you need them :) )</p>\n\n<p>Sent from my iPhone</p>\r\n            </div>\r\n        </div>\r\n        <script>\r\n            hljs.initHighlightingOnLoad();\r\n            $(function() {\r\n\r\n                // If you click on an image open it in a new window\r\n                $(\"img\").click(function() {\r\n                    var url = $(this).attr(\"src\");\r\n                    window.open(url, \"_blank\");\r\n                });\r\n            });\r\n        </script>\r\n    </body>\r\n</html>",
    "Tags": [
      "Dynamics CRM",
      "Sharepoint",
      "Unsupported"
    ]
  }
]